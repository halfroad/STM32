/*
 * eeprom.c
 *
 *  Created on: Sep 10, 2023
 *      Author: jinhui
 */

#include <string.h>

#include "eeprom.h"

#define EEPROM_WRITE_ADDRESS	0xA0
#define EEPROM_READ_ADDRESS		0xA1


char WriteBuffer[] = "2C (Inter-Integrated Circuit; pronounced as “eye-squared-C”), alternatively known as I2C or IIC, is a synchronous, multi-master/multi-slave (controller/target), packet switched, single-ended, serial communication bus invented in 1982 by Philips Semiconduct", ReadBuffer[BUFFER_SIZE];


void write()
{
	for (uint8_t i = 0; i < strlen(WriteBuffer); i ++)
		WriteBuffer[i] = i;

	printf("\r\n EEPROM 24C02 Write Test OK \r\n");

	for (uint8_t i = 0; i < strlen(WriteBuffer); i ++)
	{
		HAL_StatusTypeDef status = HAL_I2C_Mem_Write(&hi2c1, EEPROM_WRITE_ADDRESS, i, I2C_MEMADD_SIZE_8BIT, &WriteBuffer[i], 1, 0xff);

		if (status)
			printf("%c\r\n", WriteBuffer[i]);
		HAL_Delay(5);
	}

	printf("Write bytes into AT24C02 EEPROM id done...\r\n");
}

void read()
{
	HAL_I2C_Mem_Read(&hi2c1, EEPROM_READ_ADDRESS, 0, I2C_MEMADD_SIZE_8BIT, ReadBuffer, BUFFER_SIZE, 0xff);

	for (uint8_t i = 0; i < BUFFER_SIZE; i ++)
		printf("0x%02X ", ReadBuffer[i]);
}
